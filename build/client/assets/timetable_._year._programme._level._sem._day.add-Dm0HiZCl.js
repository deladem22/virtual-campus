import{R as a,j as e}from"./jsx-runtime-CAOzMBF_.js";import{d as v}from"./dayjs.min-DReL-Uwu.js";import{u as z,a as k}from"./index.esm-eIWaUr6p.js";import{d as B}from"./days-DkqQ87fy.js";import{i as H}from"./time-2AcYv75b.js";import{u as $,L as y}from"./large-select-D1kH_rXC.js";import{B as J}from"./button-D3-ocrTF.js";import{I as n}from"./input-DaKQDKVv.js";import{u as D,a as R,b as V}from"./index-BqmKY8Xa.js";import{a as I,u as Y,L as G}from"./components-BUh_SX-e.js";import"./clsx-B-dksMZM.js";import"./modal-BvqMTZsz.js";function K({courses:r,instructors:o}){const{level:L,day:w}=D(),{programme:t}=I(),{user:h}=Y("root")||{},{handleSubmit:C,register:l,setValue:b,watch:c,formState:{errors:j}}=z({defaultValues:{consent:!1,courseId:null,timeEnd:v().add(1,"hour").format("HH:mm"),instructorId:null,location:"",timeStart:v().format("HH:mm"),programmeId:t==null?void 0:t.id}}),[E,p]=a.useState(!1),[F,f]=a.useState(!1),g=$(),T=R(),q=V(),i=a.useMemo(()=>r.map(({code:s,id:x,name:P})=>({label:`${s}: ${P}`,value:x})),[r]),d=a.useMemo(()=>o.map(({id:s,name:x})=>({label:x,value:s})),[o]),N=c("instructorId"),S=c("courseId"),m=a.useMemo(()=>d.find(s=>s.value===N),[N,d]),u=a.useMemo(()=>i.find(s=>s.value===S),[S,i]);async function O(s){await g.submit(JSON.stringify(s),{action:"/courses",encType:"application/json",method:"POST"})}async function A(s){await g.submit(JSON.stringify(s),{action:"/instructors",encType:"application/json",method:"POST"})}async function M(s){s.instructorId&&s.courseId&&T(JSON.stringify(s),{action:"..",encType:"application/json",method:"POST"})}return e.jsxs("form",{onSubmit:C(M),children:[e.jsx("header",{className:"font-bold text-lg mb-2",children:"Add Lesson"}),!h&&e.jsxs("div",{className:"mb-2 p-2 rounded-lg bg-blue-50 text-blue-500 my-2 dark:bg-blue-700 dark:bg-opacity-10 dark:text-blue-400",children:["You need to"," ",e.jsx(G,{className:"underline",to:"/login",children:"Login"})," ","first to be able to add a timetable entry."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"border border-zinc-200 dark:border-neutral-600 rounded-lg px-2",children:t==null?void 0:t.name}),e.jsxs("div",{className:"border border-zinc-200 dark:border-neutral-600 rounded-lg px-2",children:["L",L]}),e.jsxs("div",{className:"border border-zinc-200 dark:border-neutral-600 rounded-lg px-2",children:[B[Number(w)],"s"]})]}),e.jsxs("div",{className:"text-secondary flex gap-2 mt-2",children:[e.jsx("div",{className:"i-lucide-corner-left-up"})," You're adding a lesson for the above"]}),e.jsxs("label",{className:"block mt-4",children:[e.jsx("span",{children:"Course"}),e.jsx(y,{label:"Course",open:E,onToggle:p,options:i,newForm:e.jsx(Q,{}),onAdd:O,onSelect:s=>{b("courseId",s),p(!1)},children:(u==null?void 0:u.label)??"Select a course"})]}),e.jsxs("label",{className:"mt-2 block",children:[e.jsx("span",{children:"Instructor"}),e.jsx(y,{label:"Instructor",open:F,onToggle:f,options:d,newForm:e.jsx(U,{}),onAdd:A,onSelect:s=>{b("instructorId",s),f(!1)},children:(m==null?void 0:m.label)??"Select an instructor"})]}),e.jsxs("div",{className:"grid grid-cols-3 mt-2 gap-2",children:[e.jsx("div",{className:"col-span-1",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{children:"Start time"}),e.jsx(n,{type:"time",...l("timeStart",{required:!0})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{children:"End time"}),e.jsx(n,{type:"time",...l("timeEnd",{required:!0,validate:s=>H(c("timeStart"),s)||"Should be after start time"})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{children:"Location"}),e.jsx(n,{...l("location",{required:!0})}),e.jsx("small",{className:"text-secondary",children:"Eg. SF24 (Group 1)"})]})})]}),j.timeEnd&&e.jsx("span",{className:"text-red-500 text-sm",children:j.timeEnd.message}),e.jsxs("label",{className:"flex gap-2 mt-2",children:[e.jsx("div",{children:e.jsx("input",{className:"!border border-zinc-300 dark:bg-neutral-600 dark:border-neutral-500 rounded-md w-5 h-5",type:"checkbox",...l("consent",{required:!0})})}),e.jsxs("div",{children:["By clicking ",e.jsx("span",{className:"font-medium",children:"Save lesson"}),", you agree that these details are correct and conform to the"," ",e.jsx("a",{className:"underline",href:"/crowdsourcing#ethics",children:"crowdsourcing ethics"}),". Providing false information can lead to permanent ban."]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(J,{disabled:!h||q.state==="submitting",children:[e.jsx("div",{className:"i-lucide-corner-down-left opacity-50"})," Save lesson"]})})]})}function Q(){const{register:r}=k();return e.jsxs("div",{className:"p-2",children:[e.jsxs("label",{className:"block",children:["Code",e.jsx(n,{...r("code",{required:!0})}),e.jsx("small",{className:"text-secondary",children:"Eg. Math 171"})]}),e.jsxs("label",{className:"block mt-2",children:["Name",e.jsx(n,{...r("name",{required:!0})}),e.jsx("small",{className:"text-secondary",children:"Eg. Logic and Set Theory"})]})]})}function U(){const{register:r}=k();return e.jsx("div",{className:"p-2",children:e.jsxs("label",{className:"block",children:["Name",e.jsx(n,{...r("name",{required:!0})})]})})}function ce(){const{courses:r,instructors:o}=I();return e.jsx(K,{courses:r,instructors:o})}export{ce as default};

import{j as e,R as p}from"./jsx-runtime-CAOzMBF_.js";import{c as j}from"./clsx-B-dksMZM.js";import{N as C}from"./module-Do5bProg.js";import{d as E}from"./days-DkqQ87fy.js";import{u as k,d as $,O as T}from"./index-B3TG-iMG.js";import{L as b,u as L,a as w}from"./components-B61dXm5I.js";import{u as D}from"./index.esm-eIWaUr6p.js";import{b as y,t as v,i as A}from"./time-2AcYv75b.js";import{u as F}from"./large-select-mtqL2FVJ.js";import{B as u}from"./button-D3-ocrTF.js";import{I as N}from"./input-DaKQDKVv.js";import{M as S}from"./modal-Yn7LYWtH.js";import{T as M}from"./timetable-filter-BRtNf1Ny.js";import{A as I}from"./anchor-CpThXzRC.js";import"./dayjs.min-DReL-Uwu.js";import"./select-D6U1yScx.js";function O({className:a,selectedDay:s=1}){const{year:r,programme:d,level:n,sem:i}=k();return e.jsx("div",{className:j("flex gap-2",a),children:E.map((c,l)=>e.jsx(b,{to:`/timetable/${r}/${d}/${n}/${i}/${l}`,className:j("text-center font-medium flex-1 px-2 bg-zinc-200 dark:bg-neutral-800 rounded-lg text-secondary hover:bg-zinc-300 dark:hover:bg-neutral-700 transition-[background] duration-200",{"!bg-blue-600 !text-white":l===s}),children:c.substring(0,3)},l))})}function R({checked:a,lesson:s,onClick:r}){const[d,n]=p.useState(!1),i=F(),{user:c}=L("root")||{},l=p.useCallback(()=>n(!1),[]),{handleSubmit:x,register:t,watch:o,formState:{errors:h}}=D({defaultValues:{timeStart:y(s.timeStart),timeEnd:y(s.timeEnd),location:s.location}});function g(m){m.preventDefault(),m.stopPropagation(),n(!0)}async function f(){confirm("Are you sure you want to delete this lesson? This cannot be undone.")&&(await i.submit(null,{encType:"application/json",action:`/lessons/${s.id}`,method:"DELETE"}),n(!1))}async function z(m){await i.submit(JSON.stringify(m),{encType:"application/json",action:`/lessons/${s.id}`,method:"PATCH"}),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:j("block w-full text-start group p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-neutral-800 transition-[background] duration-200 cursor-pointer",{"bg-zinc-100 dark:bg-neutral-800":a}),onClick:r,type:"button",children:[e.jsxs("header",{className:"font-mono text-sm text-secondary",children:[v(s.timeStart)," — ",v(s.timeEnd)," @"," ",e.jsx("span",{children:s.location})]}),e.jsxs("div",{className:"font-medium",children:[s.course.code,": ",s.course.name]}),e.jsx("footer",{className:"text-sm text-secondary flex justify-between",children:e.jsx("span",{children:s.instructor.name})}),e.jsx("div",{className:j("flex gap-2 mt-2 justify-end opacity-0 transition-opacity duration-250 h-0",{"opacity-100 h-auto":a}),children:e.jsxs(u,{className:"dark:bg-zinc-700",variant:"neutral",onClick:g,children:[e.jsx("div",{className:"i-lucide-edit-3 opacity-50"})," Edit"]})})]}),e.jsx(S,{open:d,onClose:l,className:"w-full max-w-[24rem]",children:e.jsxs("form",{className:"w-full",onSubmit:x(z),children:[e.jsxs("header",{className:"p-2 pb-0",children:[e.jsxs("div",{className:"text-sm text-secondary flex gap-2 items-center mb-2 font-medium",children:[e.jsx("div",{className:"i-lucide-scan-search"})," Edit lesson"]}),e.jsxs("p",{children:["You're editing the lesson: ",e.jsx("b",{children:s.course.name})]})]}),!c&&e.jsxs("div",{className:"bg-blue-50 text-blue-500 my-2 dark:bg-blue-700 dark:bg-opacity-10 dark:text-blue-400 mb-2 p-2 rounded-lg mx-2",children:["You need to"," ",e.jsx(b,{className:"underline",to:"/login",children:"Login"})," ","first to be able to add a timetable entry."]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("div",{className:"col-span-1",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{children:"Start time"}),e.jsx(N,{type:"time",...t("timeStart",{required:!0})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{children:"End time"}),e.jsx(N,{type:"time",...t("timeEnd",{required:!0,validate:m=>A(o("timeStart"),m)||"Should be after start time"})}),h.timeEnd&&e.jsx("span",{className:"text-red-500",children:h.timeEnd.message})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{children:"Location"}),e.jsx(N,{...t("location",{required:!0})}),e.jsx("small",{className:"text-secondary",children:"Eg. SF24"})]})})]}),e.jsx("p",{className:"text-secondary",children:"If you need to change the course and lecturer, you need to delete this schedule and create a new one."})]}),e.jsx("footer",{className:"p-2 border-t border-zinc-300 dark:border-neutral-700",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"neutral",type:"button",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(u,{variant:"neutral",type:"button",onClick:f,children:[e.jsx("div",{className:"opacity-50 i-lucide-trash-2"})," Delete"]})]}),e.jsx(u,{variant:"primary",children:"Save"})]})})]})})]})}function Y(){const[a,s]=p.useState(!1),{programmes:r}=w(),d=p.useCallback(()=>s(!1),[]),{year:n,programme:i,sem:c,level:l}=k(),x=`/downloads/timetable/${n}/${i}/${l}/${c}`,t=r.find(o=>o.slug===i);return e.jsxs(e.Fragment,{children:[e.jsxs(u,{onClick:()=>s(!0),children:[e.jsx("div",{className:"size-4",children:e.jsx("div",{className:"i-lucide-calendar-plus opacity-50"})})," ","Save to calendar"]}),e.jsx(S,{open:a,onClose:d,className:"w-full max-w-[24rem]",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("header",{className:"flex text-secondary p-2 items-center text-sm gap-2",children:[e.jsx("div",{className:" i-lucide-calendar-plus"}),e.jsx("div",{children:"Save to Calendar"})]}),e.jsxs("div",{className:"px-2 mb-2",children:[e.jsxs("p",{children:["You're about to download the calendar file which contains all the schedule for"," ",e.jsx("code",{className:"bg-zinc-200 dark:bg-neutral-700 px-1 rounded",children:t==null?void 0:t.name})," ",e.jsxs("code",{className:"bg-zinc-200 dark:bg-neutral-700 px-1 rounded",children:["L",l]})," ","Semester"," ",e.jsx("code",{className:"bg-zinc-200 dark:bg-neutral-700 px-1 rounded",children:c})," ","for the year"," ",e.jsx("code",{className:"bg-zinc-200 dark:bg-neutral-700 px-1 rounded",children:n}),"."]}),e.jsx("p",{className:"mt-2 text-secondary",children:"After download, open file to automically fill your calendar."}),e.jsx("p",{className:"mt-2",children:"🌶️ You may need to manually adjust your calendar when there are changes."})]}),e.jsxs("footer",{className:"flex justify-between p-2 border-t border-zinc-200 dark:border-neutral-700",children:[e.jsx(u,{variant:"neutral",onClick:()=>s(!1),children:"Cancel"}),e.jsx(I,{to:x,download:!0,reloadDocument:!0,children:"Download ics file"})]})]})})]})}const ae=({data:a})=>{const s=`See timetable for ${a==null?void 0:a.programme}, L${a==null?void 0:a.level} for the year ${a==null?void 0:a.year}`;return[{title:`Timetable | ${a==null?void 0:a.school.shortName} ✽ gctuvc`},{name:"description",content:s}]};function te(){const{day:a,programmes:s,schedule:r}=w(),[d,n]=p.useState(0),i=$(),c=r.reduce((t,o)=>t+(o.timeEnd-o.timeStart)/60,0),l=Math.floor(c/60),x=c-l*60;return e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 xl:grid-cols-6 gap-4 min-h-[60vh]",children:[e.jsxs("div",{className:j("col-span-1 lg:col-span-2 xl:col-span-3",{"max-lg:hidden":i}),children:[e.jsx(M,{programmes:s}),e.jsx(O,{className:"mt-2",selectedDay:a}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsxs(b,{className:"flex items-center gap-2 rounded-lg bg-zinc-200 px-2 py-1 dark:bg-neutral-800 font-medium",to:"add",onClick:()=>C.capture("add_lesson_clicked"),children:[e.jsx("div",{className:"size-4",children:e.jsx("div",{className:"i-lucide-list-plus opacity-50"})})," ","Add lesson"]}),e.jsx(Y,{})]}),e.jsx("ul",{className:"mt-2",children:r.map((t,o)=>{const h=r[o+1],g=h?h.timeStart-t.timeEnd:0,f=Math.floor(g/3600);return e.jsxs("li",{children:[e.jsx(R,{lesson:t,checked:t.id===d,onClick:()=>{t.id===d?n(0):n(t.id)}}),o<r.length-1&&e.jsx("hr",{className:"border-zinc-300 dark:border-neutral-600"}),f>2&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"rounded-b-lg bg-zinc-200 dark:bg-neutral-600 text-sm font-medium text-zinc-800 dark:text-neutral-200 px-2",children:[Math.floor(f)," hours apart"]})})})]},t.id)})}),r.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-sm border rounded-full inline-block px-2 border-zinc-300 dark:border-neutral-700 text-secondary",children:[r.length," lessons • ",l,"h ",x,"m total"]})}),r.length===0&&e.jsxs("div",{className:"text-center text-secondary mt-12",children:[e.jsx("div",{className:"bg-rose-100 dark:bg-rose-700 dark:bg-opacity-20 rounded-lg size-12 inline-flex items-center justify-center",children:e.jsx("div",{className:"i-lucide-cup-soda inline-block text-3xl rounded-lg text-rose-500"})}),e.jsx("p",{className:"mt-2",children:"No lessons for today"}),e.jsxs("p",{children:["If a lesson is missing, you can"," ",e.jsx(b,{className:"bg-zinc-200 dark:bg-neutral-700 dark:text-neutral-300 rounded-md px-2 py-1 text-inherit font-medium",to:"add",children:"Add new lesson"})]})]})]}),e.jsx("div",{className:"col-span-1 lg:col-span-2 xl:col-span-3",children:e.jsx(T,{})})]})})}export{te as default,ae as meta};

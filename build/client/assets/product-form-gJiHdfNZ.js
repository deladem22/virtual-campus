import{R as m,j as e}from"./jsx-runtime-CAOzMBF_.js";import{u as T}from"./index.esm-eIWaUr6p.js";import{F as A,u as U}from"./file-input-AkW8SXRP.js";import{B as q}from"./button-D3-ocrTF.js";import{I as p}from"./input-DaKQDKVv.js";import{S as w}from"./select-D6U1yScx.js";import{T as F}from"./textarea-D9GvzXla.js";import{a as P,b as C}from"./components-B61dXm5I.js";const c=5;function J({product:s}){const{categories:b}=P(),{register:o,handleSubmit:j}=T({defaultValues:{name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",price:(s==null?void 0:s.price)||"",category:(s==null?void 0:s.categoryId)||1}}),[l,d]=m.useState([]),[r,f]=m.useState(()=>JSON.parse((s==null?void 0:s.images)||"[]")),[N,u]=m.useState(!1),g=C(),h=!!s;async function v(a){if(r.length+l.length===0){alert("You need to add at least 1 image");return}const t=[...r];if(l.length){u(!0);try{for(const i of l)t.push(await U(i))}catch{return}finally{u(!1)}}a.images=JSON.stringify(t),g.submit(JSON.stringify(a),{method:h?"PATCH":"POST",encType:"application/json"})}function y(a){const t=a.target.files;if(!(t!=null&&t.length))return;const i=c-(l.length+r.length),n=Array.from(t).slice(0,i);if(n.length===0){alert(`You already have ${c} uploaded. You need to remove some before adding any.`);return}d(I=>[...I,...n])}const S=l.length+r.length<c,x=g.state==="submitting"||N;return e.jsxs("form",{onSubmit:j(v),children:[e.jsxs("label",{children:["Product name",e.jsx(p,{...o("name",{required:!0})})]}),e.jsxs("label",{className:"mt-2",children:["Category",e.jsx(w,{...o("category",{required:!0,valueAsNumber:!0}),children:b.map(a=>e.jsx("option",{value:a.id,children:a.title},a.id))})]}),e.jsxs("label",{className:"mt-2",children:["Price",e.jsx(p,{type:"number",...o("price",{required:!0,valueAsNumber:!0,min:.5})})]}),e.jsxs("label",{className:"mt-2",children:["Description ",e.jsx("span",{className:"text-secondary text-sm",children:"(optional)"}),e.jsx(F,{placeholder:"Talk about the product. Mention available sizes, variants, etc.",...o("description",{maxLength:720})})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2 my-2",children:[r.map((a,t)=>e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.thumbnail,alt:`Existing ${t+1}`,className:"w-full aspect-square object-cover rounded-lg"}),e.jsx("button",{className:"absolute right-0 bottom-0 p-1 bg-red-500 text-white rounded-lg rounded-lb-0 rounded-rt-0",type:"button",onClick:()=>{f(i=>i.filter(n=>n!==a))},children:e.jsx("div",{className:"i-lucide-trash-2"})})]})},a.url)),l.map((a,t)=>e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`To upload ${t+1}`,className:"w-full aspect-square object-cover rounded-lg"}),e.jsx("button",{className:"absolute right-0 bottom-0 p-1 bg-red-500 text-white rounded-lg rounded-lb-0 rounded-rt-0",type:"button",onClick:()=>{d(i=>i.filter(n=>n!==a))},children:e.jsx("div",{className:"i-lucide-trash-2"})})]})},a.name))]}),e.jsxs(A,{accept:"image/*",className:"w-[8.5rem]",multiple:!0,onChange:y,disabled:!S,children:[e.jsx("div",{className:"i-lucide-image-plus opacity-40"})," Add images"]}),e.jsx("div",{className:"text-sm text-secondary",children:"At least 1 image is required. You can add up to 5 images."}),e.jsx("footer",{className:"mt-4",children:e.jsx(q,{disabled:x,children:x?"Savingâ€¦":h?"Update product":"Add product"})})]})}export{J as P};
